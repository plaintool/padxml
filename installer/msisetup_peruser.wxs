<?xml version="1.0" encoding="utf-8"?>
<!--
    # This comment is generated by WixEdit, the specific commandline
    # arguments for the WiX Toolset are stored here.

    candleArgs: 
    lightArgs: "<projectname>.wixobj" -out "padxml-1.1.0.msi" <extensions>
-->
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
	<?define ProductVersion = "1.0.0" ?>
	<?if $(var.Platform) = x64 ?>
        <?define ProductName = "PadXml $(var.ProductVersion)" ?>
        <?define Win64Value = "yes" ?>
        <?define PlatformProgramFilesFolder = "ProgramFiles64Folder" ?>
		<?define ExeName = "padxml.exe" ?>
		<?define ExeNameUpper = "PADXML.EXE" ?>
        <?define SystemFolder = "System64Folder" ?>
    <?else?>
        <?define ProductName = "PadXml $(var.ProductVersion) (32-bit)" ?>
        <?define Win64Value = "no" ?>
        <?define PlatformProgramFilesFolder = "ProgramFilesFolder" ?>
		<?define ExeName = "padxml32.exe" ?>
		<?define ExeNameUpper = "PADXML32.EXE" ?>
        <?define SystemFolder = "SystemFolder" ?>
    <?endif?>
    
    <Product Id="*" Name="$(var.ProductName)" Language="1033" Version="$(var.ProductVersion)" Manufacturer="Alexander Tverskoy" UpgradeCode="0E008975-7ED6-4C8A-B846-47DC2546EFE7">
        <Package Description="$(var.ProductName)" Comments="PadXml" Platform="$(var.Platform)" InstallerVersion="200" Compressed="yes" InstallScope="perUser" />
        <Property Id="MSIINSTALLPERUSER" Value="1" />
        <Property Id="MSIFASTINSTALL" Value="1" />
        <WixVariable Id="WixUILicenseRtf" Value="LICENSE.rtf" />
        <Media Id="1" Cabinet="simple.cab" EmbedCab="yes" />
        <Upgrade Id="45C75BC5-3DDC-453B-A7AB-7E2AE0D88699">
            <UpgradeVersion Minimum="0.0.0" IncludeMinimum="yes" Maximum="$(var.ProductVersion)" IncludeMaximum="yes" Property="PREVIOUSFOUND" />
        </Upgrade>
        <InstallExecuteSequence>
            <RemoveExistingProducts After="InstallInitialize" />
        </InstallExecuteSequence>
        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="LocalAppDataFolder">
                <Directory Id="INSTALLDIR" Name="PadXml">
                    <Component Id="PadXmlFiles" DiskId="1" Guid="DF4C9C23-8413-447A-AF79-7495E589BE9B" Win64="$(var.Win64Value)">
                        <!-- Files to be installed -->
                        <File Id="$(var.ExeNameUpper)" Name="$(var.ExeName)" Source="..\$(var.ExeName)" />
                        <File Id="LICENSE" Name="LICENSE" Source="..\LICENSE" />
                        <!-- Registry KeyPath to satisfy ICE38 -->
                        <RegistryValue Root="HKCU" Key="Software\Alexander Tverskoy\PadXml" Name="InstallPath" Type="string" Value="[INSTALLDIR]" KeyPath="yes" />
                        <!-- Remove INSTALLDIR on uninstall -->
                        <RemoveFolder Id="RemoveINSTALLDIR" Directory="INSTALLDIR" On="uninstall" />
                    </Component>
                </Directory>
            </Directory>
            <Directory Id="DesktopFolder" />
            <Directory Id="ProgramMenuFolder">
                <Directory Id="ProgramMenuDir" Name="PadXml">
                    <Component Id="PadXmlShortcuts" Guid="BF487BC8-1C10-4BB9-A141-B292A4ADFA37" Permanent="yes">
                        <RegistryValue Root="HKCU" Key="Software\Alexander Tverskoy\PadXml" Name="InstallPath" Type="string" Value="[INSTALLDIR]" />
                        <Shortcut Id="desktopShortcut" Directory="DesktopFolder" Name="PadXml" WorkingDirectory="INSTALLDIR" Target="[INSTALLDIR]$(var.ExeName)" Icon="DesktopIcon.exe" IconIndex="0" />
                        <Shortcut Id="ExeShortcut" Directory="ProgramMenuDir" Name="PadXml" Target="[INSTALLDIR]$(var.ExeName)" Icon="StartMenuIcon.exe" IconIndex="0" />
                    </Component>
                    <Component Id="StartMenuShortcuts" Guid="3B47D63E-AE77-4DDB-B495-6809CC959310">
                        <RemoveFolder Id="ProgramMenuDir" On="uninstall" />
                        <RegistryValue Root="HKCU" Key="Software\Alexander Tverskoy\PadXml" Name="Product" Type="string" Value="[ProductName]" />
                        <Shortcut Id="UninstallProduct" Name="Uninstall" Description="Uninstalls the application" Target="[$(var.SystemFolder)]msiexec.exe" Arguments="/x [ProductCode]" />
                    </Component>
                </Directory>
            </Directory>
        </Directory>
        <Component Id="PadXmlRegistry" Directory="INSTALLDIR" Guid="4A5B87A9-6F9F-4AD4-A9AB-4D3D9DAB4FC8" Win64="$(var.Win64Value)">
            <!-- Add .pad extension association -->
            <RegistryKey Root="HKCU" Key="Software\Classes\.pad" Action="createAndRemoveOnUninstall">
                <RegistryValue Type="string" Value="padxml" KeyPath="yes" />
                <!-- Add "New â†’ TSK File" to context menu -->
                <RegistryKey Key="ShellNew" Action="createAndRemoveOnUninstall">
                    <RegistryValue Name="NullFile" Type="string" Value="" />
                </RegistryKey>
            </RegistryKey>
            <!-- Define the padxml file association -->
            <RegistryKey Root="HKCU" Key="Software\Classes\padxml" Action="createAndRemoveOnUninstall">
                <RegistryValue Type="string" Value="PadXml Tasks" />
                <RegistryKey Key="DefaultIcon">
                    <RegistryValue Type="string" Value="[INSTALLDIR]$(var.ExeName),1" />
                </RegistryKey>
                <RegistryKey Key="shell\open\command">
                    <RegistryValue Type="string" Value="&quot;[INSTALLDIR]$(var.ExeName)&quot; &quot;%1&quot;" />
                </RegistryKey>
            </RegistryKey>
            <!-- Add application association in the registry -->
            <RegistryKey Root="HKCU" Key="Software\Classes\Applications\$(var.ExeName)" Action="createAndRemoveOnUninstall">
                <RegistryKey Key="shell\open\command">
                    <RegistryValue Type="string" Value="&quot;[INSTALLDIR]$(var.ExeName)&quot; &quot;%1&quot;" />
                </RegistryKey>
            </RegistryKey>
        </Component>
        <Feature Id="DefaultFeature" Title="Main Feature" Level="1">
            <ComponentRef Id="PadXmlFiles" />
            <ComponentRef Id="PadXmlShortcuts" />
            <ComponentRef Id="StartMenuShortcuts" />
            <ComponentRef Id="PadXmlRegistry" />
        </Feature>
        <UI>
            <UIRef Id="WixUI_Minimal" />
        </UI>
        <Icon Id="DesktopIcon.exe" SourceFile="..\$(var.ExeName)" />
        <Icon Id="StartMenuIcon.exe" SourceFile="..\$(var.ExeName)" />
    </Product>
</Wix>